---
title: "Reactã®åŸºæœ¬ã®ã‚ã‚Œã“ã‚Œã‚’`console.log()`ã§ç¢ºèªã—ã¦ã¿ãŸ"
emoji: "â¬›ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['react']
published: true
---
Click ğŸ‘‰ to read the article in English.https://takuyakikuchi.tech/i-checked-this-and-that-of-react-basics-with-consolelog

# `console.log`ã—ã¦ã¿ãŸ

:::message
ãƒ­ã‚°çµæœã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã™ã‚‹ãŸã‚ã«ã€Strict Modeã‚’æ„å›³çš„ã«ç„¡åŠ¹ã«ã—ã¦ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãŒ2å›å‘¼ã³å‡ºã•ã‚Œã“ã¨ãŒãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
[strict ãƒ¢ãƒ¼ãƒ‰ â€“ React](https://ja.reactjs.org/docs/strict-mode.html)
:::

## 1. è¦ªã¨å­ã§ã®Stateæ›´æ–°ã¨ã€å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### ç¢ºèªäº‹é …
- è¦ªã¨å­ã®stateãŒå¤‰æ›´ã•ã‚Œã‚‹éš›ã®ã€å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ç™ºç”Ÿã‚’ç¢ºèªã™ã‚‹ã€‚

### ã‚³ãƒ¼ãƒ‰
- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š`App`
- å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š
  - `ChildA`(`App`ã‹ã‚‰propsã‚’å—ã‘å–ã‚‹)
    - `count`stateã‚’æŒã¤
  - `ChildB`(`App`ã‹ã‚‰propsã‚’å—ã‘å–ã‚‰ãªã„)

```diff jsx
const ChildA = ({ state }) => {
  const [count, setCount] = React.useState(0);
+ console.log(`rendering in child A component: count has ${count}`);
  return (
    ...
      <button onClick={() => setCount(count + 1)}>Child A: Count-up</button>
    ...
  );
};
const ChildB = () => {
+ console.log("rendering in child B component");
  return <div>Child B doesn't have props passed from the parent</div>;
};
export default function App() {
  const [state, setState] = React.useState(false);
+ console.log("rendering in parent component");
  return (
    <div className="App">
      ...
      <button onClick={() => setState(!state)}>Update the parent state</button>
      ...
      <ChildA state={state} />
      ...
      <ChildB />
    </div>
  );
}
```

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
```console: Console
<!-- 1. Initial rendering -->
rendering in parent component 
rendering in child A component: count has 0 
rendering in child B component 
<!-- 2. Update the parent state -->
rendering in parent component 
rendering in child A component: count has 0 
rendering in child B component 
<!-- 3. Update the child A state -->
rendering in child A component: count has 1 
<!-- 4. Update the parent state -->
rendering in parent component 
rendering in child A component: count has 1 
rendering in child B component 
```

### ç¢ºèªã—ãŸã“ã¨
- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®stateãŒå¤‰æ›´ã•ã‚ŒãŸéš›ã«ã€propsã®å—ã‘æ¸¡ã—ã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšã€è¦ªã€å­ã©ã¡ã‚‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã™ã‚‹ã€‚(No.2å‚ç…§)
- å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®stateã®å¤‰æ›´ã¯ã€ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã™ã‚‹ã€‚(No.3å‚ç…§)
- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ã€å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ã¯å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®stateã¯æœ€æ–°ãŒç¶­æŒã•ã‚Œã‚‹ã€‚(No.4å‚ç…§)

### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
@[codesandbox](https://codesandbox.io/embed/rendering-usestate-default-fwk9xt?fontsize=14&hidenavigation=1&theme=dark)

## 2. useStateåˆæœŸå€¤ vs é…å»¶åˆæœŸåŒ–

### ç¢ºèªäº‹é …
- stateã®é…å»¶åˆæœŸåŒ–ãŒåˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®æ™‚ã®ã¿ã€å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
- ä¸€æ–¹ã€åˆæœŸå€¤ã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¯ã«å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

[React: Lazy initial state](https://ja.reactjs.org/docs/hooks-reference.html#lazy-initial-state)

### ã‚³ãƒ¼ãƒ‰
- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š`App`
- å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š`Child`
  - `childStateA` state: é…å»¶åˆæœŸåŒ–
  - `childStateB` state: åˆæœŸå€¤

```diff jsx
const someExpensiveCalculation = (number, type) => {
+ console.log(`in the ${type} initial state`);
  return number * 10;
};
const Child = ({ number }) => {
  const [childStateA, setChildStateA] = React.useState(() => {
    return someExpensiveCalculation(number, "lazy");
  });
  const [childStateB, setChildStateB] = React.useState(
    someExpensiveCalculation(number, "default")
  );
  console.log(
+   `rendering in child component: A: ${childStateA}, B: ${childStateB}`
  );
  return (
    <>
      <p>{`The childStateA is ${childStateA}`}</p>
      <button onClick={() => setChildStateA(childStateA + 1)}>
        Child A: Count-up
      </button>
      <p>{`The childStateB is ${childStateB}`}</p>
      <button onClick={() => setChildStateB(childStateB + 1)}>
        Child B: Count-up
      </button>
    </>
  );
};
export default function App() {
  const [state, setState] = React.useState(false);
  return (
    <div className="App">
      <button onClick={() => setState(!state)}>Update the parent state</button>
      <Child number={10} />
    </div>
  );
}
```
### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°

```console: Console
<!-- 1. Initial rendering -->
in the lazy initial state 
in the default initial state 
rendering in child component: A: 100, B: 100 
<!-- 2. Parent state update -->
in the default initial state 
rendering in child component: A: 100, B: 100 
<!-- 3. Child state A update -->
in the default initial state 
rendering in child component: A: 101, B: 100 
<!-- 3. Child state B update -->
in the default initial state 
rendering in child component: A: 101, B: 101 
<!-- 4. Parent state update -->
in the default initial state 
rendering in child component: A: 101, B: 101 
```

### ç¢ºèªã—ãŸã“ã¨
- é…å»¶åˆæœŸåŒ–ã‚’è¡Œãˆã°ã€**åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®ã¿**`someExpensiveCalculation()`ãŒå‘¼ã°ã‚Œã¦ã„ã¦ã€å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚
- ä¸€æ–¹ã€é…å»¶åˆæœŸåŒ–ã§ãªãå€¤ã‚’æ¸¡ã—ãŸã¨ãã«ã¯ã€**å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒèµ°ã‚‹ãŸã³**`someExpensiveCalculation()`ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚

### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
@[codesandbox](https://codesandbox.io/embed/heuristic-goldwasser-gwvki8?fontsize=14&hidenavigation=1&theme=dark)

## 3. `useEffect`ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

### ç¢ºèªäº‹é …
- `useEffect`ã«æ¸¡ã•ã‚ŒãŸé–¢æ•°ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ã®çµæœãŒç”»é¢ã«åæ˜ ã•ã‚ŒãŸå¾Œã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

[React: useEffect](https://ja.reactjs.org/docs/hooks-reference.html#useeffect)

### ã‚³ãƒ¼ãƒ‰
- `state`ã‚’ä¾å­˜ã™ã‚‹å€¤ã¨ã—ã¦ã„ã‚‹`useEffect`ã«ã¦ã€dataã‚’fetchå¾Œã€`message`ã‚¹ãƒ†ãƒ¼ãƒˆã‚’æ›´æ–°ã™ã‚‹ã€‚

```diff jsx
const dataFetchMock = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("setMessage executed in useEffect");
  }, 1500);
});
export default function App() {
  const [message, setMessage] = React.useState();
  const [state, setState] = React.useState(false);
  React.useEffect(() => {
+   console.log(`in useEffect. state: ${state}`);
    dataFetchMock.then((value) => {
      setMessage(value);
    });
  }, [state]);

+ console.log(`rendering: just before return jsx. message: ${message}`);
  return (
    <div className="App">
      <button onClick={() => setState(!state)}>Update the parent state</button>
      <p>{message === undefined ? "undefined" : message}</p>
    </div>
  );
}
```
### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
```console: Console
<!-- 1. Initial rendering -->
rendering: just before return jsx. message: undefined 
in useEffect. state: false 
rendering: just before return jsx. message: setMessage executed in useEffect 
<!-- 2. State(dependency of the useEffect) updated -->
rendering: just before return jsx. message: setMessage executed in useEffect 
in useEffect. state: true 
rendering: just before return jsx. message: setMessage executed in useEffect 
```

### ç¢ºèªã—ãŸã“ã¨
- **useEffectã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å¾Œã«å‹•ä½œã—ã¦ã„ã‚‹ã€‚**
  - åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§(No.1å‚ç…§)ã€ã¾ãšã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° => `useEffect` => `useEffect`å†…ã§ã®`message`ã‚¹ãƒ†ãƒ¼ãƒˆã®å¤‰æ›´ã§å†åº¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  - `useEffect`ã®ä¾å­˜é…åˆ—ã«å«ã¾ã‚Œã¦ã„ã‚‹stateã®æ›´æ–°(No.2å‚ç…§)ã§ã¯ã€stateã®æ›´æ–°ã«ã‚ˆã‚‹ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° => `useEffect` => `useEffect`å†…ã§ã®`message`ã‚¹ãƒ†ãƒ¼ãƒˆã®å¤‰æ›´ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
@[codesandbox](https://codesandbox.io/embed/useeffect-timing-4qjgsk?fontsize=14&hidenavigation=1&theme=dark)

# ã¾ã¨ã‚

ãªã‚“ã¨ãªãã®ç†è§£ã§ä½¿ã†ã“ã¨ã®ã§ãã‚‹Reactã€‚
ã ã‘ã©ã€å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã©ã€è‡ªåˆ†ã§ç¢ºèªã—ã¦ã¿ã‚‹ã“ã¨ã¯æœ‰æ„ç¾©ã ã¨æ€ã£ãŸã€‚
