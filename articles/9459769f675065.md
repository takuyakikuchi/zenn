---
title: "Storybook Play function ã¨ã¯"
emoji: "ğŸ¤¸â€â™€ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["storybook", "testing", "frontend"]
published: true
---
ã“ã®è¨˜äº‹ã§ã¯ã€Storybook ã® Play function ã«ã¤ã„ã¦è©±ã‚’ã—ã¾ã™ã€‚

## Play function ã¨ã¯

https://storybook.js.org/docs/writing-stories/play-function

> Play functions are small snippets of code executed after the story renders. Enabling you to interact with your components and test scenarios that otherwise required user intervention.
https://storybook.js.org/docs/writing-stories/play-function

Play function ã¯ **ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’å«ã‚€ Story ã®å®šç¾©ã‚’å¯èƒ½ã¨ã™ã‚‹æ©Ÿèƒ½** ã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚

Story ã¯ä½•ã‹ã¨ã„ã†ã¨ã€
> A story captures the rendered state of a UI component. Developers write multiple stories per component that describe all the â€œinterestingâ€ states a component can support.
https://storybook.js.org/docs/get-started/whats-a-story

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚µãƒãƒ¼ãƒˆã§ãã‚‹ â€èˆˆå‘³æ·±ã„çŠ¶æ…‹â€ ã®ã‚­ãƒ£ãƒ—ãƒãƒ£**ã§ã™ã€‚

ã“ã‚Œã‚‰ã‚’åˆã‚ã›ã¦æ•´ç†ã™ã‚‹ã¨ã€Play function ã¯
ã€Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã€**ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’å«ã‚€èˆˆå‘³æ·±ã„çŠ¶æ…‹** ã®å®šç¾©ã€ã‚’å¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

### ä¾‹

Only Available ã¨ã„ã† Story ã«ã¦ Play function ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ã€Œãƒ¦ãƒ¼ã‚¶ãŒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå¾Œã®ã€ã‚¹ãƒˆãƒƒã‚¯ã®ã‚ã‚‹å•†å“ãŒè¡¨ç¤ºã•ã‚ŒãŸçŠ¶æ…‹ã€ã‚’ Story ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

![A story with play function](https://storage.googleapis.com/zenn-user-upload/45665640b443-20240310.png)
*(ç”»åƒã®ã‚­ãƒ£ãƒ—ãƒãƒ£å…ƒ: https://www.youtube.com/clip/Ugkx9Yn1tl4Nm33eAD6kTD2svqYLq8QA0YP7 3:46æ™‚ç‚¹)*

## ãƒ†ã‚¹ãƒˆã§å†åˆ©ç”¨

Play function ã¯ã€**ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’å«ã‚€èˆˆå‘³æ·±ã„çŠ¶æ…‹** ã‚’å®šç¾©ã§ãã‚‹æ©Ÿèƒ½ã ã¨ã™ã‚‹ã¨ã€
Play function ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã‚‹çŠ¶æ…‹ã¯ã€ãƒ†ã‚¹ãƒˆã«ã¦å‹•ä½œã¨çµæœãŒä¿è¨¼ã•ã‚Œã‚‹ã¹ãçŠ¶æ…‹ã§ã‚ã‚Šã€**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã®å†åˆ©ç”¨** ã«é©ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ä¸Šã§ã‚‚ã€Story ã‚’ç°¡å˜ã«å†åˆ©ç”¨ã™ã‚‹ä»•çµ„ã¿ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ React ã®ãƒ†ã‚¹ãƒˆã«ã¦ Play function ã‚’å†åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```tsx
// ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å…¥åŠ›ã‚’ã™ã‚‹ Story ã‚’å®šç¾©
export const InputFieldFilled: Story<InputFieldProps> = {
  play: async ({ canvasElement }) => {
    const canvas = within(canvasElement);
    await userEvent.type(canvas.getByRole('textbox'), 'Hello world!');
  },
};
```

```tsx
const { InputFieldFilled } = composeStories(stories);

test('renders with play function', async () => {
  // ğŸ‘‡ ä¸Šè¨˜ Story ã‚’å†åˆ©ç”¨
  const { container } = render(<InputFieldFilled />);
  await InputFieldFilled.play({ canvasElement: container });

  const input = screen.getByRole('textbox') as HTMLInputElement;
  expect(input.value).toEqual('Hello world!');
});
```
Play function ã®ãƒ†ã‚¹ãƒˆã§ã®å†åˆ©ç”¨ã®ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ã¯ã€**è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ãªãŒã‚‰ãƒ†ã‚¹ãƒˆã‚’æ›¸ãäº‹ãŒå¯èƒ½ã«ãªã‚‹** ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚é€šå¸¸ã€testing-library ç­‰ã§è¨˜è¿°ã™ã‚‹ãƒ†ã‚¹ãƒˆã¯ã€è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãªã—ã«ã€ãƒˆãƒ©ã‚¤ & ã‚¨ãƒ©ãƒ¼ã‚’ç¹°ã‚Šè¿”ã—ãªãŒã‚‰å®Ÿè£…ã—ã¦ã„ãå¤§å¤‰ãªä½œæ¥­ã§ã™ã€‚

å®Ÿè£…ã®è©³ç´°ã¯ã€ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚ï¼ˆä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚‚ä»¥ä¸‹ãƒªãƒ³ã‚¯å…ˆã‚ˆã‚Šå¼•ç”¨ã—ã¦ã„ã¾ã™ï¼‰
https://github.com/storybookjs/testing-react

## ã¾ã¨ã‚

- Play function ã¯ **ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’å«ã‚€èˆˆå‘³æ·±ã„çŠ¶æ…‹** ã‚’ Story ã¨ã—ã¦å®šç¾©ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ãŸ
- **ãƒ†ã‚¹ãƒˆã«å†åˆ©ç”¨å¯èƒ½** ã§ã‚ã‚Šã€Storybook ã§ã‚‚ã€ãƒ†ã‚¹ãƒˆã§ã‚‚ãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã§ãã‚‹æ©Ÿèƒ½
- å®Ÿè£…ã¯ç°¡å˜

ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
Happy coding! ğŸš€

## ãŠã¾ã‘

Play function ã‚’è©¦ã™ä¸­ã§ã§ã¤ã¾ãšã„ãŸç‚¹ã‚’å…±æœ‰ã—ã¾ã™ã€‚

### Interactions ã‚¿ãƒ–ã« interactions ãŒè¡¨ç¤ºã•ã‚Œãªã„

```tsx
// ğŸ™…ğŸ»: `@testing-library/react` ã® `within` ã¨ `userEvent` ã‚’ä½¿ã£ã¦ã„ãŸ
import { userEvent, within } from '@testing-library/react';
// ğŸ™†: `@storybook/testing-library` ã‚’ä½¿ã†
import { userEvent, within } from '@storybook/testing-library';
```

å‚è€ƒï¼š
https://stackoverflow.com/questions/75475488/storybook-play-function-doesnt-show-interactions-in-the-bottom-panel

### `Cannot invoke an object which is possibly 'undefined'.` 

```tsx
export const CombinedStories: Story = {
  play: async (context) => {
    // ğŸ™…ğŸ»: Error: Cannot invoke an object which is possibly 'undefined'.
    await FirstStory.play(context);
    await SecondStory.play(context);
    // ğŸ™†
    await FirstStory.play?.(context);
    await SecondStory.play?.(context);
  },
};
```

å‚è€ƒï¼š
https://github.com/storybookjs/storybook/issues/21969#issuecomment-1647287480

### `Pass a context when invoking play function of another story`

```tsx
export const CombinedStories: Story = {
  // ğŸ™…ğŸ»
  play: async ({canvasElement}) => {
    // Error: `Pass a context when invoking play function of another story`
    await FirstStory.play?.(canvasElement);
  }
  // ğŸ™†: context ã‚’ãã®ã¾ã¾æ¸¡ã™å¿…è¦ã‚ã‚Š
  play: async (context) => {
    await FirstStory.play?.(context);
  }
};
```
å‚è€ƒï¼š
https://github.com/storybookjs/eslint-plugin-storybook/blob/main/docs/rules/context-in-play-function.md

---
If you want to read this article in English, here is the link: https://dev.to/takuyakikuchi/what-is-storybook-play-function-2bmb