---
title: "Reactã®ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç† 5 ã¤ã®åŸå‰‡"
emoji: "ğŸ§‘ğŸ»â€ğŸ«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, frontend]
published: false
---
## TL;DR

**5 ã¤ã®åŸå‰‡**
1. å¸¸ã«ä¸€ç·’ã«å¤‰ã‚ã‚‹ state ã¯ã€ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹
2. çŸ›ç›¾ã—ãªã„ã‚ˆã†ã«ã€é–¢é€£ã™ã‚‹ state ã¯ç®¡ç†ã™ã‚‹
3. æ—¢å­˜ã® state ã‚„ props ã‹ã‚‰è¨ˆç®—ã§ãã‚‹å€¤ã¯ state ã«ã—ãªã„
4. é‡è¤‡ã‚’é¿ã‘ã‚‹
5. æ·±ã„ãƒã‚¹ãƒˆã‚’é¿ã‘ã€ãƒ•ãƒ©ãƒƒãƒˆã«ã™ã‚‹

## ã¯ã˜ã‚ã«

> Structuring state well can make a difference between a component that is pleasant to modify and debug, and one that is a constant source of bugs.
> ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ã†ã¾ãæ§‹é€ åŒ–ã™ã‚‹ã“ã¨ã§ã€ä¿®æ­£ã‚„ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚„ã™ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã€ãƒã‚°ã®çµ¶ãˆãªã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é•ã„ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚(DeepL ç¿»è¨³) 
> *[Choosing the State Structure](https://react.dev/learn/choosing-the-state-structure)*

æœ€è¿‘ã€React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® state ã®é‡è¤‡ã¨ã€ãã‚Œã«ä¼´ã† `useEffect()` ã®ä¸é©åˆ‡ãªä½¿ç”¨ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†æ©Ÿä¼šãŒã‚ã‚Šã¾ã—ãŸã€‚
ãã®éš›ã«ã€[Choosing the State Structure](https://react.dev/learn/choosing-the-state-structure) ã®è¨˜äº‹ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ 5 ã¤ã®åŸå‰‡ã‚’äº‹å‰ã«æ„è­˜ã§ãã¦ã„ã‚Œã°ã€ã“ã®ã‚ˆã†ãªè² å‚µã¯ã‚ã‚‹ç¨‹åº¦é˜²ã’ãŸã¯ãšã§ã‚ã‚‹ã¨æ€ã„ã¾ã—ãŸã€‚
ã“ã®è¨˜äº‹ã§ã¯ã€ãã® 5 ã¤ã®åŸå‰‡ã‚’åºƒã‚ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
å…ƒè¨˜äº‹ã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’åŸºã«ã—ã¦ã„ã¾ã™ãŒã€ã‚ˆã‚Šã‚¢ã‚¯ã‚»ã‚¹ã—ã‚„ã™ã„ã‚ˆã†ç­†è€…ãªã‚Šã«æ•´ç†ã—ã¾ã—ãŸã€‚ã—ãŸãŒã£ã¦ã€ç­†è€…ã®è§£é‡ˆã«åŸºã¥ãè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ã”äº†æ‰¿ãã ã•ã„ã€‚

## 5 ã¤ã®åŸå‰‡

### 1. å¸¸ã«ä¸€ç·’ã«å¤‰ã‚ã‚‹ state ã¯ã€ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹

*[Group related state](https://react.dev/learn/choosing-the-state-structure#group-related-state)* ã‚ˆã‚Š

ä»¥ä¸‹ã®åº§æ¨™ã®ä¾‹ã®ã‚ˆã†ã«ã€ã„ã¤ã‚‚ä¸€ç·’ã«å¤‰åŒ–ã™ã‚‹å€¤ã¯ã€1 ã¤ã® state ã§ç®¡ç†ã—ã¾ã—ã‚‡ã†ã€‚
ãã†ã™ã‚‹ã“ã¨ã§ã€å€¤ã®åŒæœŸã«åŒæœŸã«æ‚©ã¾ã•ã‚Œã‚‹ã“ã¨ãŒãªããªã‚Šã¾ã™ã€‚

```diff jsx
  // ğŸ‘  `x` ã¨ `y` ã¯å¸¸ã«ä¸€ç·’ã«å¤‰åŒ–ã™ã‚‹ãŒã€åˆ¥ã€…ã® state ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹
- const [x, setX] = useState(0)ï¼›
- const [y, setY] = useState(0)ï¼›

  // ğŸ‘ 1 ã¤ã® state ã«ã¾ã¨ã‚ã‚‹
+ const [position, setPosition]=useState({ x: 0, y: 0 })ï¼›
```

### 2. çŸ›ç›¾ã—ãªã„ã‚ˆã†ã«ã€é–¢é€£ã™ã‚‹ state ã¯ç®¡ç†ã™ã‚‹

*[Avoid contradictions in state](https://react.dev/learn/choosing-the-state-structure#avoid-contradictions-in-state)* ã‚ˆã‚Š

çŠ¶æ…‹ãŒçŸ›ç›¾ã—ãªã„ã‚ˆã†ã€ã©ã®ã‚ˆã†ãª state ã«ã©ã‚“ãªå€¤ã‚’ä¿æŒã™ã‚‹ã‹è€ƒãˆã¾ã—ã‚‡ã†ã€‚
çŸ›ç›¾ãŒèµ·ãã¦ã—ã¾ã†çŠ¶æ³ã‚’é˜²ãã“ã¨ã§ã€ãƒã‚°ã®ãƒªã‚¹ã‚¯ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```diff jsx
export default function FeedbackForm() {
  // ğŸ‘ `isSending` ã¨ `isSent` ãŒåŒæ™‚ã« `true` ã«ãªã‚‹ã“ã¨ã¯ãªã„ãŒã€ãã®ã‚ã‚Šå¾—ãªã„çŠ¶æ…‹ãŒå¯èƒ½ã¨ãªã£ã¦ã„ã‚‹
- const [isSending, setIsSending] = useState(false);
- const [isSent, setIsSent] = useState(false);

  // ğŸ‘ æœ‰åŠ¹ãªå€¤ã®ã†ã¡ã® 1 ã¤ã‚’æŒã¤ã€1 ã¤ã® state ã«ç½®ãæ›ãˆã‚‹('typing'ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰ã€'sending'ã€'sent' ã®ã„ãšã‚Œã‹)
+ const [status, setStatus] = useState('typing');

  async function handleSubmit(e) {
    e.preventDefault();
-   setIsSending(true);
+   setStatus('sending');
    await sendMessage(text);
-   setIsSending(false);
-   setIsSent(true);
+   setStatus('sent');
  }
  ...
```

### 3. æ—¢å­˜ã® state ã‚„ props ã‹ã‚‰è¨ˆç®—ã§ãã‚‹å€¤ã¯ state ã«ã—ãªã„

*[Avoid redundant state](https://react.dev/learn/choosing-the-state-structure#avoid-redundant-state)* ã‚ˆã‚Š

ä¸è¦ãª state ç®¡ç†ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã™ã€‚
è¨ˆç®—ã§ãã‚‹å€¤ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ãã®éƒ½åº¦è¨ˆç®—ã™ã‚‹ã“ã¨ã§ã€åŒæœŸãŒå–ã‚Œãªããªã‚‹å¿ƒé…ãŒãªããªã‚Šã€è¤‡é›‘åº¦ã‚‚ãƒã‚°ã®ãƒªã‚¹ã‚¯ã‚‚æ¸›ã‚‰ã›ã¾ã™ã€‚

```diff jsx
export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');

  // ğŸ‘ã€€`fullName` ã¯ `firstName` ã¨ `lastName` ã‹ã‚‰è¨ˆç®—ã§ãã‚‹ãŒã€state ã¨ã—ã¦ã„ã‚‹
- const [fullName, setFullName] = useState('');
  // ğŸ‘ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã« `fullName` ã‚’è¨ˆç®—ã™ã‚‹
+ const fullName = firstName + ' ' + lastName;

  function handleFirstNameChange(e) {
    setFirstName(e.target.value);
-   setFullName(e.target.value + ' ' + lastName);
  }

  function handleLastNameChange(e) {
    setLastName(e.target.value);
-   setFullName(firstName + ' ' + e.target.value);
  }
  ...
}
```

::::details ã“ã®ã‚ˆã†ãªå†—é•·ãª state ã¯ã€useEffect() ã®èª¤ã£ãŸä½¿ã„æ–¹ã‚’èª˜ç™ºã™ã‚‹ä¾‹ã§ã‚‚ã‚ã‚Šã¾ã™ğŸ˜£

```jsx
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [fullName, setFullName] = useState('');
  ...
  // ğŸ‘ `fullName` state ã‚’ `useEffect()` ã‚’ä½¿ã£ã¦æ›´æ–°ã™ã‚‹
  useEffect(() => {
    setFullName(firstName + ' ' + lastName);
  }, [firstName, lastName]);
  ...
```
*[You might not need an effect](https://react.dev/learn/you-might-not-need-an-effect#updating-state-based-on-props-or-state)* ã‚ˆã‚Š

`useEffect()` ã®èª¤ã£ãŸåˆ©ç”¨ã¯ã€ä½™åˆ†ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé…ããªã‚Šã€å¿…è¦ä»¥ä¸Šã«è¤‡é›‘åŒ–ã—ã€åŒæœŸãƒŸã‚¹ã«ã‚ˆã‚‹ãƒã‚°ã‚’ç”Ÿã‚€å¯èƒ½æ€§ãŒç”Ÿã¿ã¾ã™ã€‚
::::

### 4. é‡è¤‡ã‚’é¿ã‘ã‚‹
*[Avoid redundant state](https://react.dev/learn/choosing-the-state-structure#avoid-redundant-state)* ã‚ˆã‚Š

é‡è¤‡ã—ã¦ã„ã‚‹ state ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã€ç®¡ç†ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚å¿…è¦ãªæƒ…å ±ã ã‘ã‚’ state ã§ä¿æŒã—ã¾ã—ã‚‡ã†ã€‚

```diff jsx
const initialItems = [
  { title: 'pretzels', id: 0 },
  { title: 'crispy seaweed', id: 1 },
  { title: 'granola bar', id: 2 },
];

export default function Menu() {
  const [items, setItems] = useState(initialItems);
   // ğŸ‘ `items` state ãŒæŒã¤å€¤ã® 1 ã¤ã¨åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã€`selectedItem` ã«ä¿æŒã•ã‚Œã¦ã„ã‚‹ã®ã§é‡è¤‡ãŒèµ·ã“ã£ã¦ã„ã‚‹
   //    `items = [{ id: 0, title: 'pretzels'}, ...]`
   //    `selectedItem = { idï¼š0, title: 'pretzels'}`
-  const [selectedItem, setSelectedItem] = useState(items[0]);
   // ğŸ‘ `selectedId` ã‚’ state ã«ä¿æŒã™ã‚‹ã“ã¨ã§ã€é‡è¤‡ã‚’é¿ã‘å¿…è¦ãªçŠ¶æ…‹ã ã‘ã‚’ä¿æŒã—ã¦ã„ã‚‹
   //    `items = [{ id: 0, title:'pretzels'}, ...];
   //    `selectedId = 0`
+  const [selectedId, setSelectedId] = useState(0);

   // ğŸ‘ itemsé…åˆ—ã‹ã‚‰ãã®IDã‚’æŒã¤itemã‚’æ¤œç´¢ã—ã¦selectedItemã‚’å–å¾—
+  const selectedItem = items.find(item =>
+    item.id === selectedId
+  ); 

  function handleItemChange(id, e) {
    setItems(items.map(item => {
      if (item.id === id) {
        return {
          ...item,
          title: e.target.value,
        };
      } else {
        return item;
      }
    }));
    // ğŸ‘ `selectedItem` ã®æ›´æ–°ã‚’è¡Œã‚ãªã„ã¨ãƒã‚°ã«ãªã‚‹
-   setSelectedItem(...);
  }

  return (
    <>
      <h2>What's your travel snack?</h2> 
      <ul>
        {items.map((item, index) => (
          <li key={item.id}>
            <input
              value={item.title}
              onChange={e => {
                handleItemChange(item.id, e)
              }}
            />
            {' '}
            <button onClick={() => {
              setSelectedItem(item);
            }}>Choose</button>
          </li>
        ))}
      </ul>
      <p>You picked {selectedItem.title}.</p>
    </>
  );
}
```

### 5. æ·±ã„ãƒã‚¹ãƒˆã‚’é¿ã‘ã€ãƒ•ãƒ©ãƒƒãƒˆã«ã™ã‚‹

*[Avoid deeply nested state](https://react.dev/learn/choosing-the-state-structure#avoid-deeply-nested-state)* ã‚ˆã‚Š

è¤‡é›‘ãªãƒã‚¹ãƒˆã¯ç®¡ç†ãŒé›£ã—ããªã‚ŠãŒã¡ã§ã™ã€‚å¯èƒ½ã§ã‚ã‚Œã°ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è¦‹ç›´ã—ã€ãƒ•ãƒ©ãƒƒãƒˆãªæ§‹é€ ã«ã—ã¾ã—ã‚‡ã†ã€‚

```diff js: places.js
  // ğŸ‘ ãƒã‚¹ãƒˆã•ã‚ŒãŸæ§‹é€ 
- export const initialTravelPlan = {
-   id: 0,
-   title: '(Root)',
-   childPlaces: [{
-     // æƒ‘æ˜Ÿãƒ¬ãƒ™ãƒ«
-     id: 1,
-     title: 'Earth',
-     childPlaces: [{
-       // å¤§é™¸ãƒ¬ãƒ™ãƒ«
-       id: 2,
-       title: 'Africa',
-       childPlaces: [{
-         // å›½ãƒ¬ãƒ™ãƒ«
-         id: 3,
-         title: 'Botswana',
-         childPlaces: []
-       }, { 
-         ...
-       }], 
-     }, {
-       // å¤§é™¸ãƒ¬ãƒ™ãƒ«
-       ...
-     }],
-   }, {
-     // æƒ‘æ˜Ÿãƒ¬ãƒ™ãƒ«
-     ...
-   }],
- };
  // ğŸ‘ ãƒ•ãƒ©ãƒƒãƒˆåŒ–
+ export const initialTravelPlan = {
+   0: {
+     id: 0,
+     title: '(Root)',
+     childIds: [1, 42, 46],
+   },
+   1: {
+     id: 1,
+     title: 'Earth',
+     childIds: [2, 10, 19, 26, 34]
+   },
+   2: {
+     id: 2,
+     title: 'Africa',
+     childIds: [3, 4, 5, 6 , 7, 8, 9]
+   }, 
+   3: {
+     id: 3,
+     title: 'Botswana',
+     childIds: []
+   },
+   ...
+ };
```

## ã¾ã¨ã‚

**5 ã¤ã®åŸå‰‡**
1. å¸¸ã«ä¸€ç·’ã«å¤‰ã‚ã‚‹ state ã¯ã€ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹
2. çŸ›ç›¾ã—ãªã„ã‚ˆã†ã«ã€é–¢é€£ã™ã‚‹ state ã¯ç®¡ç†ã™ã‚‹
3. æ—¢å­˜ã® state ã‚„ props ã‹ã‚‰è¨ˆç®—ã§ãã‚‹å€¤ã¯ state ã«ã—ãªã„
4. é‡è¤‡ã‚’é¿ã‘ã‚‹
5. æ·±ã„ãƒã‚¹ãƒˆã‚’é¿ã‘ã€ãƒ•ãƒ©ãƒƒãƒˆã«ã™ã‚‹

å…ƒè¨˜äº‹ã®æœ€å¾Œã®èª²é¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã‚Œã‚‰ã®åŸå‰‡ãŒä½“ç³»çš„ã«ç†è§£ã§ãã‚‹ã®ã§ã€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼

https://react.dev/learn/choosing-the-state-structure

Happy coding! ğŸš€
